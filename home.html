<script type="module">
  console.log("âœ… home.html èª­ã¿è¾¼ã¿é–‹å§‹");

  import { supabase, requireAuth } from "./js/api.js";

  // ğŸ”’ ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
  await requireAuth();

  const list = document.getElementById("articles");
  const emptyMsg = document.getElementById("emptyMsg");

  async function loadArticles() {
    const { data, error } = await supabase
      .from("articles")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      list.innerHTML = `<li>èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</li>`;
      return;
    }

    if (!data || data.length === 0) {
      emptyMsg.style.display = "block";
      return;
    }

    list.innerHTML = data
      .map(a => `<li><a href="article.html?id=${a.id}">${a.title || "ï¼ˆç„¡é¡Œï¼‰"}</a></li>`)
      .join("");
  }

  await loadArticles();

  // âœï¸ æ–°è¦è¨˜äº‹ãƒœã‚¿ãƒ³
  document.getElementById("newBtn").addEventListener("click", () => {
    window.location.href = "new.html";
  });

  // ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await supabase.auth.signOut();
    window.location.href = "index.html";
  });
</script>
