<script type="module">
  console.log("✅ home.html 読み込み開始");

  import { supabase, requireAuth } from "./js/api.js";

  // 🔒 ログインチェック
  await requireAuth();

  const list = document.getElementById("articles");
  const emptyMsg = document.getElementById("emptyMsg");

  async function loadArticles() {
    const { data, error } = await supabase
      .from("articles")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      list.innerHTML = `<li>読み込みエラー: ${error.message}</li>`;
      return;
    }

    if (!data || data.length === 0) {
      emptyMsg.style.display = "block";
      return;
    }

    list.innerHTML = data
      .map(a => `<li><a href="article.html?id=${a.id}">${a.title || "（無題）"}</a></li>`)
      .join("");
  }

  await loadArticles();

  // ✍️ 新規記事ボタン
  document.getElementById("newBtn").addEventListener("click", () => {
    window.location.href = "new.html";
  });

  // 🚪 ログアウト
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await supabase.auth.signOut();
    window.location.href = "index.html";
  });
</script>
