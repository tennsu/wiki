<!-- home.htmlå†…ã®è©²å½“ç®‡æ‰€ -->
<script type="module">
  console.log("âœ… home.html èª­ã¿è¾¼ã¿é–‹å§‹");

  import { supabase } from "./js/api.js";

  const { data, error } = await supabase.auth.getSession();
  console.log("ğŸ§  ã‚»ãƒƒã‚·ãƒ§ãƒ³:", data, error);

  if (!data.session) {
    console.log("ğŸšª æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ index.htmlã¸");
    window.location.href = "index.html";
  } else {
    console.log("ğŸ‘¤ ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿:", data.session.user.email);
  }
</script>

  import { supabase, requireAuth } from "./js/api.js";

  await requireAuth();

  const list = document.getElementById("articles");
  const emptyMsg = document.getElementById("emptyMsg");

  async function loadArticles() {
    const { data, error } = await supabase
      .from("articles")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      list.innerHTML = `<li>èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</li>`;
      return;
    }

    if (!data || data.length === 0) {
      emptyMsg.style.display = "block";
      return;
    }

    list.innerHTML = data
      .map(a => `<li><a href="article.html?id=${a.id}">${a.title || "ï¼ˆç„¡é¡Œï¼‰"}</a></li>`)
      .join("");
  }

  await loadArticles();

  // âœï¸ æ–°è¦è¨˜äº‹ãƒœã‚¿ãƒ³
  document.getElementById("newBtn").addEventListener("click", () => {
    window.location.href = "new.html"; // âœ… ä¿®æ­£ï¼
  });

  // ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await supabase.auth.signOut();
    window.location.href = "index.html";
  });
</script>
