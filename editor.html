<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¨˜äº‹ç·¨é›†</title>
  <script src="https://cdn.tiny.cloud/1/tj631xvvm36oh9q1fud6srms54cpa8yj5mlxxrofrao7qdhl/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
  <style>
    body { background:#f3f5f7; text-align:center; font-family:sans-serif; padding:30px; }
    textarea { width:90%; height:400px; }
  </style>
</head>
<body>
  <h1>è¨˜äº‹ç·¨é›†</h1>
  <input id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" style="width:70%;padding:10px;"><br><br>
  <textarea id="editor"></textarea><br>
  <button id="saveBtn">ğŸ’¾ ä¿å­˜</button>
  <button id="previewBtn">ğŸ‘ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>

  <div id="previewArea" style="display:none; background:white; margin:30px auto; width:80%; padding:20px; border-radius:8px; text-align:left;"></div>

  <!-- âœ… TinyMCEåˆæœŸåŒ–ã¯é€šå¸¸ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ -->
  <script>
    tinymce.init({
      selector: '#editor',
      height: 500,
      menubar: true,
      plugins: 'link image code lists table',
      toolbar: 'undo redo | styles | bold italic underline | alignleft aligncenter alignright | bullist numlist | link image | code',
      branding: false
    });
  </script>

  <!-- âœ… Supabaseä¿å­˜ãªã©ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ -->
  <script type="module">
    import { supabase } from "./js/api.js";

    document.getElementById("saveBtn").addEventListener("click", async () => {
      const title = document.getElementById("title").value.trim() || "ç„¡é¡Œ";
      const content = tinymce.activeEditor.getContent();

      const { error } = await supabase.from("articles").insert([{ title, content }]);
      if (error) alert("âŒ ä¿å­˜å¤±æ•—: " + error.message);
      else {
        alert("âœ… ä¿å­˜ã—ã¾ã—ãŸï¼");
        window.location.href = "home.html";
      }
    });

    document.getElementById("previewBtn").addEventListener("click", () => {
      const html = tinymce.activeEditor.getContent();
      const preview = document.getElementById("previewArea");
      preview.innerHTML = html;
      preview.style.display = "block";
    });
  </script>
</body>
</html>
